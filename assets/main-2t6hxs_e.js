import{r as c,j as e,c as $}from"./index-T_edayIv.js";const _=({topic:p,remainingMs:i,progress:o,isRunning:m,onStart:x,onPause:f,onReset:u})=>{const g=Math.floor(i/1e3),N=Math.floor(g/60),j=g%60,t=Math.floor(i%1e3/10),v=o*360,r=()=>i<=0||i<=5e3?"#ef4444":i<=15e3?"#f59e0b":"#06b6d4",k=()=>i<=0||i<=5e3?"#ef4444":i<=15e3?"#f59e0b":"#10b981",b=r(),l=k();return c.useEffect(()=>{const d=n=>{if(!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement))switch(n.key.toLowerCase()){case" ":n.preventDefault(),m?f():x();break;case"r":n.preventDefault(),u();break}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[m,x,f,u]),e.jsxs("div",{className:"stopwatch-container",children:[e.jsxs("div",{className:"mobile-pie-view",children:[e.jsx("div",{className:"topic-display-mobile",children:e.jsx("h2",{className:"topic-text-mobile",children:p})}),e.jsxs("svg",{className:"pie-chart",viewBox:"0 0 120 120",children:[e.jsx("defs",{children:e.jsxs("mask",{id:"pieMask",children:[e.jsx("circle",{cx:"60",cy:"60",r:"60",fill:"white"}),e.jsx("path",{d:`
                  M 60 60
                  L 60 5
                  A 55 55 0 ${o>.5?1:0} 1 
                  ${60+55*Math.sin(o*2*Math.PI)} 
                  ${60-55*Math.cos(o*2*Math.PI)}
                  Z
                `,fill:"black"})]})}),e.jsx("circle",{cx:"60",cy:"60",r:"55",fill:"rgba(255, 255, 255, 0.05)"}),e.jsx("circle",{cx:"60",cy:"60",r:"55",fill:l,mask:"url(#pieMask)",className:"pie-segment",style:{filter:i<=5e3?`drop-shadow(0 0 8px ${l})`:"none",transition:"fill 0.3s ease"}}),e.jsxs("text",{x:"60",y:"56",textAnchor:"middle",className:"pie-time",fill:"#fff",style:{fontSize:"18px",fontWeight:"bold"},children:[String(N).padStart(2,"0"),":",String(j).padStart(2,"0")]}),e.jsxs("text",{x:"60",y:"70",textAnchor:"middle",className:"pie-ms",fill:"#fff",style:{fontSize:"12px",opacity:.7},children:[".",String(t).padStart(2,"0")]})]}),e.jsxs("div",{className:"mobile-controls",children:[e.jsx("button",{onClick:m?f:x,className:"mobile-control-btn mobile-main-btn",title:m?"Space to pause":"Space to start",children:m?"⏸":"▶"}),e.jsx("button",{onClick:u,className:"mobile-control-btn mobile-reset-btn",title:"R to reset",children:"↻"})]}),e.jsx("div",{className:"keyboard-hints",children:"Space: Play/Pause • R: Reset"})]}),e.jsxs("div",{className:"desktop-watch-view",children:[e.jsx("div",{className:"topic-display",children:e.jsx("h1",{className:"topic-text",children:p})}),e.jsx("div",{className:"stopwatch",children:e.jsxs("div",{className:"stopwatch-bezel",children:[e.jsxs("svg",{className:"progress-ring",viewBox:"0 0 400 400",children:[e.jsx("circle",{cx:"200",cy:"200",r:"190",fill:"none",stroke:"rgba(255, 255, 255, 0.05)",strokeWidth:"4"}),e.jsx("circle",{cx:"200",cy:"200",r:"190",fill:"none",stroke:b,strokeWidth:"4",strokeDasharray:`${2*Math.PI*190}`,strokeDashoffset:`${2*Math.PI*190*(1-o)}`,strokeLinecap:"round",transform:"rotate(-90 200 200)",style:{transition:i<=0?"none":"stroke 0.3s ease",filter:i<=0?"drop-shadow(0 0 20px rgba(239, 68, 68, 0.8))":"none"}})]}),e.jsxs("div",{className:"stopwatch-face",children:[[...Array(12)].map((d,n)=>{const a=(n*30-90)*(Math.PI/180),w=50+42*Math.cos(a),y=50+42*Math.sin(a);return e.jsx("div",{className:"hour-marker",style:{left:`${w}%`,top:`${y}%`},children:e.jsx("div",{className:"marker-dot"})},n)}),[...Array(60)].map((d,n)=>{if(n%5===0)return null;const a=(n*6-90)*(Math.PI/180),w=50+44*Math.cos(a),y=50+44*Math.sin(a);return e.jsx("div",{className:"minute-marker",style:{left:`${w}%`,top:`${y}%`}},n)}),e.jsx("div",{className:"digital-display",children:e.jsxs("div",{className:"digital-time",style:{color:b},children:[String(N).padStart(2,"0"),":",String(j).padStart(2,"0"),".",e.jsx("span",{className:"milliseconds",children:String(t).padStart(2,"0")})]})}),e.jsx("div",{className:"hand second-hand",style:{transform:`rotate(${v}deg)`,backgroundColor:b,boxShadow:i<=0?`0 0 20px ${b}`:"none"},children:e.jsx("div",{className:"hand-tip",style:{backgroundColor:b}})}),e.jsx("div",{className:"center-dot",style:{backgroundColor:b}})]})]})})]})]})},F=({onFileLoad:p})=>{const i=c.useRef(null),[o,m]=c.useState(!1),[x,f]=c.useState(null),[u,g]=c.useState(!1),N=l=>{const d=l.split(`
`).filter(a=>a.trim()),n=[];for(const a of d){const w=a.split("|");if(w.length!==2)throw new Error(`Invalid format on line: "${a}". Expected format: "Topic Name|Duration"`);const y=w[0].trim(),S=parseInt(w[1].trim(),10);if(!y)throw new Error(`Empty topic name on line: "${a}"`);if(isNaN(S)||S<=0)throw new Error(`Invalid duration on line: "${a}". Duration must be a positive number.`);n.push({name:y,duration:S})}if(n.length===0)throw new Error("No topics found in file");return n},j=l=>{if(f(null),!l.name.endsWith(".txt")){f("Please upload a .txt file");return}const d=new FileReader;d.onload=n=>{try{const a=n.target?.result,w=N(a);p(w,u)}catch(a){f(a instanceof Error?a.message:"Failed to parse file")}},d.readAsText(l)},t=l=>{l.preventDefault(),m(!1);const d=l.dataTransfer.files[0];d&&j(d)},v=l=>{l.preventDefault(),m(!0)},r=()=>{m(!1)},k=()=>{i.current?.click()},b=l=>{const d=l.target.files?.[0];d&&j(d)};return e.jsxs("div",{className:"file-upload-container",children:[e.jsxs("div",{className:"branding",children:[e.jsx("h1",{className:"app-title",children:"MarkWatch"}),e.jsx("p",{className:"app-subtitle",children:"Presentation Timer"})]}),e.jsxs("div",{className:`upload-area ${o?"dragging":""}`,onDrop:t,onDragOver:v,onDragLeave:r,onClick:k,children:[e.jsx("input",{ref:i,type:"file",accept:".txt",onChange:b,style:{display:"none"}}),e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"upload-icon",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),e.jsx("h2",{className:"upload-title",children:"Drop your topics file here"}),e.jsx("p",{className:"upload-description",children:"or click to browse"}),e.jsx("div",{className:"upload-hint",children:"Supports .txt files"})]}),e.jsxs("div",{className:"presenter-mode-option",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:l=>g(l.target.checked)}),e.jsx("span",{children:"Show Presenter View"})]}),e.jsx("p",{className:"option-hint",children:"Opens a separate window with just the timer display"})]}),x&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),x]}),e.jsxs("div",{className:"format-guide",children:[e.jsx("h3",{className:"guide-title",children:"File Format"}),e.jsx("div",{className:"guide-content",children:e.jsxs("code",{className:"format-example",children:["Topic Name|Duration in Seconds",e.jsx("br",{}),"Introduction|90",e.jsx("br",{}),"Problem Statement|120",e.jsx("br",{}),"Solution Overview|90"]})})]})]})},I="markwatch_topics",T="markwatch_current_index";function W(){const[p,i]=c.useState(()=>{const s=localStorage.getItem(I);return s?JSON.parse(s):[]}),[o,m]=c.useState(()=>{const s=localStorage.getItem(T);return s?parseInt(s,10):0}),[x,f]=c.useState(!1),[u,g]=c.useState(0),N=c.useRef(0),j=c.useRef(void 0),t=c.useRef(null),v=p[o],r=v?.duration||90;c.useEffect(()=>{p.length>0&&localStorage.setItem(I,JSON.stringify(p))},[p]),c.useEffect(()=>{localStorage.setItem(T,o.toString())},[o]),c.useEffect(()=>{const s=h=>{x&&(h.preventDefault(),h.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[x]),c.useEffect(()=>{const s=h=>{if(!(h.target instanceof HTMLInputElement||h.target instanceof HTMLTextAreaElement))switch(h.key){case"ArrowLeft":h.preventDefault(),y();break;case"ArrowRight":h.preventDefault(),w();break}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[o,p.length]),c.useEffect(()=>{if(!x)return;const s=()=>{const E=performance.now()-N.current;g(E),E<r*1e3?j.current=requestAnimationFrame(s):(f(!1),g(r*1e3))};return N.current=performance.now()-u,j.current=requestAnimationFrame(s),()=>{j.current&&cancelAnimationFrame(j.current)}},[x,r,u]),c.useEffect(()=>{if(t.current&&!t.current.closed){const s=Math.max(0,r*1e3-u),h=r>0?u/(r*1e3):0;t.current.postMessage({type:"TIMER_UPDATE",payload:{topic:v?.name||"Loading...",remainingMs:s,progress:h,totalDuration:r}},"*")}},[v,u,r]);const k=(s,h)=>{i(s),m(0),g(0),f(!1),h&&b()},b=()=>{const E=window.screen.width-800-100,M=window.open("/presenter.html","MarkWatch Presenter",`width=800,height=800,left=${E},top=100,resizable=yes,scrollbars=no`);if(M){t.current=M;const R=A=>{if(A.data.type==="PRESENTER_READY"){const P=Math.max(0,r*1e3-u),L=r>0?u/(r*1e3):0;M.postMessage({type:"TIMER_UPDATE",payload:{topic:v?.name||"Loading...",remainingMs:P,progress:L,totalDuration:r}},"*")}};window.addEventListener("message",R);const C=setInterval(()=>{M.closed&&(clearInterval(C),window.removeEventListener("message",R),t.current=null)},1e3)}},l=()=>{x&&!window.confirm("Timer is running! Are you sure you want to clear all topics?")||(t.current&&!t.current.closed&&(t.current.close(),t.current=null),i([]),m(0),g(0),f(!1),localStorage.removeItem(I),localStorage.removeItem(T))},d=()=>{v&&(f(!0),t.current&&!t.current.closed&&t.current.postMessage({type:"TIMER_START",elapsedMs:u,totalDuration:r},"*"))},n=()=>{f(!1),t.current&&!t.current.closed&&t.current.postMessage({type:"TIMER_PAUSE"},"*")},a=()=>{f(!1),g(0),t.current&&!t.current.closed&&t.current.postMessage({type:"TIMER_PAUSE"},"*")},w=()=>{if(o<p.length-1){const s=o+1,h=p[s];m(s),g(0),f(!0),t.current&&!t.current.closed&&t.current.postMessage({type:"TIMER_START",elapsedMs:0,totalDuration:h.duration},"*")}},y=()=>{if(o>0){const s=o-1,h=p[s];m(s),g(0),f(!0),t.current&&!t.current.closed&&t.current.postMessage({type:"TIMER_START",elapsedMs:0,totalDuration:h.duration},"*")}},S=Math.max(0,r*1e3-u),D=r>0?u/(r*1e3):0;return e.jsx("div",{className:"app",children:p.length===0?e.jsx(F,{onFileLoad:k}):e.jsxs(e.Fragment,{children:[e.jsx(_,{topic:v.name,remainingMs:S,progress:D,isRunning:x,onStart:d,onPause:n,onReset:a}),e.jsxs("div",{className:"main-controls",children:[e.jsx("button",{onClick:y,disabled:o===0,className:"control-btn nav-btn",title:"Previous (← Arrow Left)",children:"←"}),x?e.jsx("button",{onClick:n,className:"control-btn pause-btn",title:"Pause (Space)",children:"⏸"}):e.jsx("button",{onClick:d,className:"control-btn start-btn",title:"Start (Space)",children:"▶"}),e.jsx("button",{onClick:a,className:"control-btn reset-btn",title:"Reset (R)",children:"↻"}),e.jsx("button",{onClick:w,disabled:o===p.length-1,className:"control-btn nav-btn",title:"Next (→ Arrow Right)",children:"→"}),e.jsx("button",{onClick:l,className:"control-btn clear-btn",title:"Clear all topics",children:"✕"})]}),e.jsx("div",{className:"status-bar",children:e.jsxs("span",{className:"topic-counter",children:[o+1," / ",p.length]})})]})})}$.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(W,{})}));
