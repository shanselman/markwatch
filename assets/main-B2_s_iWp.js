import{r as a,j as e,c as B}from"./index-T_edayIv.js";const H=({topic:h,remainingMs:o,progress:r,isRunning:u,onStart:j,onPause:N,onReset:p})=>{const f=Math.floor(o/1e3),m=Math.floor(f/60),x=f%60,k=Math.floor(o%1e3/10),g=r*360,v=()=>o<=0||o<=5e3?"#ef4444":o<=15e3?"#f59e0b":"#06b6d4",c=()=>o<=0||o<=5e3?"#ef4444":o<=15e3?"#f59e0b":"#10b981",b=v(),l=c();return a.useEffect(()=>{const i=s=>{if(!(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement))switch(s.key.toLowerCase()){case" ":s.preventDefault(),u?N():j();break;case"r":s.preventDefault(),p();break}};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[u,j,N,p]),e.jsxs("div",{className:"stopwatch-container",children:[e.jsxs("div",{className:"mobile-pie-view",children:[e.jsx("div",{className:"topic-display-mobile",children:e.jsx("h2",{className:"topic-text-mobile",children:h})}),e.jsxs("svg",{className:"pie-chart",viewBox:"0 0 120 120",children:[e.jsx("defs",{children:e.jsxs("mask",{id:"pieMask",children:[e.jsx("circle",{cx:"60",cy:"60",r:"60",fill:"white"}),e.jsx("path",{d:`
                  M 60 60
                  L 60 5
                  A 55 55 0 ${r>.5?1:0} 1 
                  ${60+55*Math.sin(r*2*Math.PI)} 
                  ${60-55*Math.cos(r*2*Math.PI)}
                  Z
                `,fill:"black"})]})}),e.jsx("circle",{cx:"60",cy:"60",r:"55",fill:"rgba(255, 255, 255, 0.05)"}),e.jsx("circle",{cx:"60",cy:"60",r:"55",fill:l,mask:"url(#pieMask)",className:"pie-segment",style:{filter:o<=5e3?`drop-shadow(0 0 8px ${l})`:"none",transition:"fill 0.3s ease"}}),e.jsxs("text",{x:"60",y:"56",textAnchor:"middle",className:"pie-time",fill:"#fff",style:{fontSize:"18px",fontWeight:"bold"},children:[String(m).padStart(2,"0"),":",String(x).padStart(2,"0")]}),e.jsxs("text",{x:"60",y:"70",textAnchor:"middle",className:"pie-ms",fill:"#fff",style:{fontSize:"12px",opacity:.7},children:[".",String(k).padStart(2,"0")]})]}),e.jsxs("div",{className:"mobile-controls",children:[e.jsx("button",{onClick:u?N:j,className:"mobile-control-btn mobile-main-btn",title:u?"Space to pause":"Space to start",children:u?"⏸":"▶"}),e.jsx("button",{onClick:p,className:"mobile-control-btn mobile-reset-btn",title:"R to reset",children:"↻"})]}),e.jsx("div",{className:"keyboard-hints",children:"Space: Play/Pause • R: Reset"})]}),e.jsxs("div",{className:"desktop-watch-view",children:[e.jsx("div",{className:"topic-display",children:e.jsx("h1",{className:"topic-text",children:h})}),e.jsx("div",{className:"stopwatch",children:e.jsxs("div",{className:"stopwatch-bezel",children:[e.jsxs("svg",{className:"progress-ring",viewBox:"0 0 400 400",children:[e.jsx("circle",{cx:"200",cy:"200",r:"190",fill:"none",stroke:"rgba(255, 255, 255, 0.05)",strokeWidth:"4"}),e.jsx("circle",{cx:"200",cy:"200",r:"190",fill:"none",stroke:b,strokeWidth:"4",strokeDasharray:`${2*Math.PI*190}`,strokeDashoffset:`${2*Math.PI*190*(1-r)}`,strokeLinecap:"round",transform:"rotate(-90 200 200)",style:{transition:o<=0?"none":"stroke 0.3s ease",filter:o<=0?"drop-shadow(0 0 20px rgba(239, 68, 68, 0.8))":"none"}})]}),e.jsxs("div",{className:"stopwatch-face",children:[[...Array(12)].map((i,s)=>{const n=(s*30-90)*(Math.PI/180),w=50+42*Math.cos(n),y=50+42*Math.sin(n);return e.jsx("div",{className:"hour-marker",style:{left:`${w}%`,top:`${y}%`},children:e.jsx("div",{className:"marker-dot"})},s)}),[...Array(60)].map((i,s)=>{if(s%5===0)return null;const n=(s*6-90)*(Math.PI/180),w=50+44*Math.cos(n),y=50+44*Math.sin(n);return e.jsx("div",{className:"minute-marker",style:{left:`${w}%`,top:`${y}%`}},s)}),e.jsx("div",{className:"digital-display",children:e.jsxs("div",{className:"digital-time",style:{color:b},children:[String(m).padStart(2,"0"),":",String(x).padStart(2,"0"),".",e.jsx("span",{className:"milliseconds",children:String(k).padStart(2,"0")})]})}),e.jsx("div",{className:"hand second-hand",style:{transform:`rotate(${g}deg)`,backgroundColor:b,boxShadow:o<=0?`0 0 20px ${b}`:"none"},children:e.jsx("div",{className:"hand-tip",style:{backgroundColor:b}})}),e.jsx("div",{className:"center-dot",style:{backgroundColor:b}})]})]})})]})]})},z=({onFileLoad:h})=>{const o=a.useRef(null),[r,u]=a.useState(!1),[j,N]=a.useState(null),[p,f]=a.useState(!1),m=l=>{const i=l.split(`
`).filter(n=>n.trim()),s=[];for(const n of i){const w=n.split("|");if(w.length!==2)throw new Error(`Invalid format on line: "${n}". Expected format: "Topic Name|Duration"`);const y=w[0].trim(),S=parseInt(w[1].trim(),10);if(!y)throw new Error(`Empty topic name on line: "${n}"`);if(isNaN(S)||S<=0)throw new Error(`Invalid duration on line: "${n}". Duration must be a positive number.`);s.push({name:y,duration:S})}if(s.length===0)throw new Error("No topics found in file");return s},x=l=>{if(N(null),!l.name.endsWith(".txt")){N("Please upload a .txt file");return}const i=new FileReader;i.onload=s=>{try{const n=s.target?.result,w=m(n);h(w,p)}catch(n){N(n instanceof Error?n.message:"Failed to parse file")}},i.readAsText(l)},k=l=>{l.preventDefault(),u(!1);const i=l.dataTransfer.files[0];i&&x(i)},g=l=>{l.preventDefault(),u(!0)},v=()=>{u(!1)},c=()=>{o.current?.click()},b=l=>{const i=l.target.files?.[0];i&&x(i)};return e.jsxs("div",{className:"file-upload-container",children:[e.jsxs("div",{className:"branding",children:[e.jsx("h1",{className:"app-title",children:"MarkWatch"}),e.jsx("p",{className:"app-subtitle",children:"Presentation Timer"})]}),e.jsxs("div",{className:`upload-area ${r?"dragging":""}`,onDrop:k,onDragOver:g,onDragLeave:v,onClick:c,children:[e.jsx("input",{ref:o,type:"file",accept:".txt",onChange:b,style:{display:"none"}}),e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"upload-icon",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),e.jsx("h2",{className:"upload-title",children:"Drop your topics file here"}),e.jsx("p",{className:"upload-description",children:"or click to browse"}),e.jsx("div",{className:"upload-hint",children:"Supports .txt files"})]}),e.jsxs("div",{className:"presenter-mode-option",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:l=>f(l.target.checked)}),e.jsx("span",{children:"Show Presenter View"})]}),e.jsx("p",{className:"option-hint",children:"Opens a separate window with just the timer display"})]}),j&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),j]}),e.jsxs("div",{className:"format-guide",children:[e.jsx("h3",{className:"guide-title",children:"File Format"}),e.jsx("div",{className:"guide-content",children:e.jsxs("code",{className:"format-example",children:["Topic Name|Duration in Seconds",e.jsx("br",{}),"Introduction|90",e.jsx("br",{}),"Problem Statement|120",e.jsx("br",{}),"Solution Overview|90"]})})]})]})},L="markwatch_topics",P="markwatch_current_index";function K(){const[h,o]=a.useState(()=>{const t=localStorage.getItem(L);return t?JSON.parse(t):[]}),[r,u]=a.useState(()=>{const t=localStorage.getItem(P);return t?parseInt(t,10):0}),[j,N]=a.useState(!0),[p,f]=a.useState(!1),[m,x]=a.useState(0),k=a.useRef(0),g=a.useRef(null),v=h[r],c=v?.duration||90;a.useEffect(()=>{h.length>0&&localStorage.setItem(L,JSON.stringify(h))},[h]),a.useEffect(()=>{localStorage.setItem(P,r.toString())},[r]),a.useEffect(()=>{const t=d=>{p&&(d.preventDefault(),d.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[p]),a.useEffect(()=>{const t=d=>{if(!(d.target instanceof HTMLInputElement||d.target instanceof HTMLTextAreaElement))switch(d.key){case"ArrowLeft":d.preventDefault(),S();break;case"ArrowRight":d.preventDefault(),y();break}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[r,h.length]),a.useEffect(()=>{if(!p)return;k.current=performance.now()-m;const t=()=>{const M=performance.now()-k.current;M<c*1e3?x(M):(f(!1),x(c*1e3))},d=setInterval(t,16);let E;const I=()=>{t(),E=requestAnimationFrame(I)};return E=requestAnimationFrame(I),()=>{clearInterval(d),E&&cancelAnimationFrame(E)}},[p,c,m]),a.useEffect(()=>{if(g.current&&!g.current.closed){const t=Math.max(0,c*1e3-m),d=c>0?m/(c*1e3):0;g.current.postMessage({type:"TIMER_UPDATE",payload:{topic:v?.name||"Loading...",remainingMs:t,progress:d,totalDuration:c,shrinkMode:j}},"*")}},[v,m,c,j]);const b=(t,d)=>{o(t),u(0),x(0),f(!1),d&&t.length>0&&requestAnimationFrame(()=>{l(t[0])})},l=t=>{const I=window.screen.width-800-100,M=100,$=new URL("./presenter.html",window.location.href).href,C=window.open($,"MarkWatch Presenter",`width=800,height=800,left=${I},top=${M},resizable=yes,scrollbars=no`);if(C){g.current=C;const R=W=>{if(W.data.type==="PRESENTER_READY"){const _=t?t.name:v?.name||"Loading...",D=t?t.duration:v?.duration||90,O=Math.max(0,D*1e3-m),U=D>0?m/(D*1e3):0;C.postMessage({type:"TIMER_UPDATE",payload:{topic:_,remainingMs:O,progress:U,totalDuration:D,shrinkMode:j}},"*"),window.removeEventListener("message",R)}};window.addEventListener("message",R);const F=setInterval(()=>{C.closed&&(clearInterval(F),g.current=null)},1e3)}},i=()=>{p&&!window.confirm("Timer is running! Are you sure you want to clear all topics?")||(g.current&&!g.current.closed&&(g.current.close(),g.current=null),o([]),u(0),x(0),f(!1),localStorage.removeItem(L),localStorage.removeItem(P))},s=()=>{v&&f(!0)},n=()=>{f(!1)},w=()=>{f(!1),x(0)},y=()=>{if(r<h.length-1){const t=r+1;u(t),x(0),f(!0)}},S=()=>{if(r>0){const t=r-1;u(t),x(0),f(!0)}},A=Math.max(0,c*1e3-m),T=c>0?m/(c*1e3):0;return e.jsx("div",{className:"app",children:h.length===0?e.jsx(z,{onFileLoad:b}):e.jsxs(e.Fragment,{children:[e.jsx(H,{topic:v.name,remainingMs:A,progress:T,isRunning:p,onStart:s,onPause:n,onReset:w}),e.jsxs("div",{className:"main-controls",children:[e.jsx("button",{onClick:S,disabled:r===0,className:"control-btn nav-btn",title:"Previous (← Arrow Left)",children:"←"}),p?e.jsx("button",{onClick:n,className:"control-btn pause-btn",title:"Pause (Space)",children:"⏸"}):e.jsx("button",{onClick:s,className:"control-btn start-btn",title:"Start (Space)",children:"▶"}),e.jsx("button",{onClick:w,className:"control-btn reset-btn",title:"Reset (R)",children:"↻"}),e.jsx("button",{onClick:y,disabled:r===h.length-1,className:"control-btn nav-btn",title:"Next (→ Arrow Right)",children:"→"}),e.jsx("button",{onClick:i,className:"control-btn clear-btn",title:"Clear all topics",children:"✕"})]}),e.jsxs("div",{className:"status-bar",children:[e.jsxs("span",{className:"topic-counter",children:[r+1," / ",h.length]}),e.jsxs("label",{style:{marginLeft:"2rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:j,onChange:t=>N(t.target.checked),style:{marginRight:"0.5rem"}}),"Shrink (vs Grow)"]})]})]})})}B.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(K,{})}));
